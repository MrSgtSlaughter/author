<!DOCTYPE html>
<html>
<head>
<base target="_top">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body { background: #0f1218; color: #eee; font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
  .card { background: #1e293b; padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #334155; }
  h1 { color: #fff; }
  h1 span { color: #FFDD00; }
  h2 { color: #3b82f6; margin-top: 0; border-bottom: 1px solid #333; padding-bottom: 10px; }
  
  /* Form Elements */
  input, select, textarea { width: 100%; padding: 12px; margin-top: 5px; background: #0f1218; border: 1px solid #475569; color: white; border-radius: 6px; box-sizing: border-box; }
  .btn { background: #0057B7; color: white; border: 0; padding: 15px; border-radius: 6px; cursor: pointer; width: 100%; font-size: 1.1rem; margin-top: 20px; font-weight: bold; }
  .btn:hover { background: #004494; }
  .btn:disabled { background: #555; cursor: wait; }
  
  /* Quiz Styles */
  .mcq-container { margin-bottom: 15px; }
  .mcq-q { font-weight: bold; margin-bottom: 5px; color: #ddd; }
  .mcq-opt { padding: 10px; background: rgba(255,255,255,0.05); margin: 5px 0; cursor: pointer; border-radius: 4px; border: 1px solid transparent; }
  .mcq-opt:hover { background: rgba(255,255,255,0.1); }
  .mcq-opt.selected { background: rgba(255, 221, 0, 0.2); border: 1px solid #FFDD00; color: #FFDD00; }
  
  /* Utils */
  .hidden { display: none; }
  a { color: #FFDD00; text-decoration: none; font-weight: bold; }
  
  /* Admin Rows */
  .admin-row { background: #2d3748; padding: 15px; margin-bottom: 10px; border-left: 4px solid #FFDD00; border-radius: 4px; }
  .admin-row input { background: #1a202c; border: 1px solid #4a5568; }
</style>
</head>
<body>

<div id="studentView">
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <h1>Ukraine <span>& Author</span></h1>
    <div onclick="showAdmin()" style="cursor:pointer; font-size:1.5rem;">‚öôÔ∏è</div>
  </div>
  
  <div class="card">
    <h2>1. Student Info</h2>
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
      <input id="fname" placeholder="First Name">
      <input id="lname" placeholder="Last Name">
    </div>
    <select id="period" style="margin-top:10px;">
      <option value="">Select Period...</option>
      <option>1st Hour</option><option>2nd Hour</option><option>3rd Hour</option>
      <option>4th Hour</option><option>5th Hour</option><option>6th Hour</option>
    </select>
  </div>

  <div class="card">
    <h2>2. Video Context</h2>
    <iframe width="100%" height="315" src="https://drive.google.com/file/d/1JIfnCUm9_4gtMHmmmR-S4GNU2uZs7B9W/preview" frameborder="0" allow="autoplay" allowfullscreen style="border-radius:8px; margin-bottom:10px;"></iframe>
    <p style="margin-bottom:15px;">üì∫ <strong>Video Link:</strong> <a href="https://drive.google.com/file/d/1JIfnCUm9_4gtMHmmmR-S4GNU2uZs7B9W/view" target="_blank">Click here if video doesn't play above</a></p>
    <div id="quiz1"></div>
  </div>

  <div class="card">
    <h2>3. Scavenger Hunt</h2>
    <p>Use the <a href="https://www.calla.com/wordpress/about-marsha/" target="_blank">Author's Website (About Page)</a> to answer these:</p>
    <div id="quiz2"></div>
  </div>

  <div class="card">
    <h2>4. Book Trailers</h2>
    <p>Rank the book trailers from 1 (Best) to 5 (Worst).</p>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; font-size:0.9rem;">
      <div>Don't Tell Nazis <input type="number" class="rank" data-name="Nazis" min="1" max="5"></div>
      <div>Making Bombs <input type="number" class="rank" data-name="Bombs" min="1" max="5"></div>
      <div>Stolen Girl <input type="number" class="rank" data-name="Stolen" min="1" max="5"></div>
      <div>Winterkill <input type="number" class="rank" data-name="Winter" min="1" max="5"></div>
      <div>Traitors <input type="number" class="rank" data-name="Traitors" min="1" max="5"></div>
    </div>
    <textarea id="reflect" placeholder="Why is #1 your favorite? (Minimum 15 words)" rows="3" style="margin-top:15px;"></textarea>
  </div>

  <div class="card">
    <h2>5. Author Question</h2>
    <textarea id="quest" placeholder="Ask Marsha Skrypuch a deep question (Why/How)..." rows="3"></textarea>
  </div>

  <button id="submitBtn" class="btn" onclick="submit()">Submit Worksheet</button>
  <div id="msg" style="margin-top:15px; font-weight:bold; color:#4ade80; text-align:center;"></div>
</div>

<div id="adminView" class="hidden">
  <button onclick="location.reload()" class="btn" style="background:#444; margin-bottom:20px;">&larr; Back to Student Mode</button>
  <h2>Teacher Grading Panel</h2>
  <div id="adminList">Loading Submissions...</div>
</div>

<script>
// --- CONTENT DATA ---
const Q1 = [
  {q:"What historical event is the central theme of 'Winterkill'?", a:["The Holodomor","World War I","The Cold War","The Orange Revolution"], c:0},
  {q:"Marsha's writing is often motivated by:", a:["Famous battles","Hidden history","Fictional fantasy","Biographies of kings"], c:1},
  {q:"In the video, what does the author say is her 'superpower'?", a:["Writing fast","Being a librarian","Listening","Researching"], c:3},
  {q:"Which book focuses on the Hitler Youth?", a:["Stolen Girl","Don't Tell the Nazis","Making Bombs for Hitler","Winterkill"], c:2}
];

const Q2 = [
  {q:"What was Marsha's first published book?", a:["Silver Threads","Harry Potter","Hunger Games","The Giver"], c:0},
  {q:"Where does Marsha live?", a:["Kyiv, Ukraine","New York, USA","Brantford, Ontario","London, UK"], c:2},
  {q:"What is Marsha's degree in?", a:["History","English","Library Science","Journalism"], c:2},
  {q:"How many books has she written?", a:["Under 5","Over 20","Exactly 10","Over 100"], c:1}
];

// --- INITIALIZE ---
window.onload = () => { 
  renderQuiz(Q1, 'quiz1', 'v'); 
  renderQuiz(Q2, 'quiz2', 's'); 
};

// --- QUIZ ENGINE ---
function renderQuiz(qs, id, prefix) {
  const d = document.getElementById(id);
  qs.forEach((item, i) => {
    let h = `<div class="mcq-container"><div class="mcq-q">${i+1}. ${item.q}</div>`;
    item.a.forEach((opt, j) => {
      h += `<div class="mcq-opt" onclick="sel(this, '${prefix}', ${item.c===j})">${opt}</div>`;
    });
    h += `</div>`;
    d.innerHTML += h;
  });
}

function sel(el, prefix, isCor) {
  // Deselect siblings
  const siblings = el.parentNode.querySelectorAll('.mcq-opt');
  siblings.forEach(e => e.classList.remove('selected'));
  // Select clicked
  el.classList.add('selected');
  el.dataset.cor = isCor; // Store correctness
}

// --- SUBMIT LOGIC ---
function submit() {
  const f = document.getElementById('fname').value;
  const l = document.getElementById('lname').value;
  const p = document.getElementById('period').value;
  const q = document.getElementById('quest').value;
  const r = document.getElementById('reflect').value;
  
  // Validation
  if(!f || !l || !p) return alert("Please fill in Name and Period.");
  if(q.split(' ').length < 5) return alert("Your Author Question is too short.");
  if(r.split(' ').length < 10) return alert("Your Trailer Reflection is too short.");

  // Calculate Score (approx 12.5 pts per question to make 100 max)
  let v=0, s=0;
  document.querySelectorAll('[onclick*="\'v\'"]').forEach(e => { if(e.classList.contains('selected') && e.dataset.cor=='true') v+=12.5; });
  document.querySelectorAll('[onclick*="\'s\'"]').forEach(e => { if(e.classList.contains('selected') && e.dataset.cor=='true') s+=12.5; });
  
  // Get Ranks
  let ranks = [];
  document.querySelectorAll('.rank').forEach(i => ranks.push(i.dataset.name + ':' + i.value));
  
  // UI Loading
  const btn = document.getElementById('submitBtn');
  btn.innerText = "Sending to Server..."; 
  btn.disabled = true;

  // Send to Google
  google.script.run.withSuccessHandler(res => {
    document.getElementById('msg').innerText = `‚úÖ SUBMITTED! Your Score: ${res.totalScore}/100. Class Rank: #${res.rank}`;
    btn.style.display = 'none';
    window.scrollTo(0, document.body.scrollHeight);
  }).withFailureHandler(e => { 
    alert("Error: " + e); 
    btn.disabled=false; 
    btn.innerText="Try Again"; 
  }).submitWorksheet({ 
    firstName: f, lastName: l, period: p, 
    videoScore: v, scavengerScore: s, 
    trailerOrder: ranks.join(', '), 
    trailerReflection: r, authorQuestion: q 
  });
}

// --- ADMIN PANEL ---
function showAdmin() {
  const p = prompt("Enter Teacher Password:");
  if(p === 'Ukraine2024') {
    document.getElementById('studentView').classList.add('hidden');
    document.getElementById('adminView').classList.remove('hidden');
    loadAdminData();
  }
}

function loadAdminData() {
  google.script.run.withSuccessHandler(data => {
    const el = document.getElementById('adminList'); 
    el.innerHTML = '';
    data.forEach(r => {
      el.innerHTML += `
        <div class="admin-row">
          <div style="font-size:1.1em; margin-bottom:5px;"><b>${r.first} ${r.last}</b> (${r.per})</div>
          <div style="color:#aaa; font-style:italic; font-size:0.9em; margin-bottom:5px;">"Q: ${r.q}"</div>
          <div style="margin-bottom:10px;">Auto-Score: ${r.auto} | <b>Total: <span id="t${r.row}">${r.tot}</span></b></div>
          <div style="display:flex; gap:10px; align-items:center;">
            <input type="number" id="s${r.row}" value="${r.teach}" placeholder="Pts" style="width:70px;"> 
            <input id="n${r.row}" value="${r.note}" placeholder="Feedback Notes"> 
            <button class="btn" onclick="saveGrade(${r.row})" style="width:auto; margin:0; padding:10px;">Save</button>
            <label style="font-size:0.8em;"><input type="checkbox" id="a${r.row}" ${r.app?'checked':''} style="width:auto;"> Show on Leaderboard</label>
          </div>
        </div>`;
    });
  }).getAdminData('Ukraine2024');
}

function saveGrade(row) {
  const score = document.getElementById('s'+row).value;
  const note = document.getElementById('n'+row).value;
  const app = document.getElementById('a'+row).checked;
  
  google.script.run.withSuccessHandler(res => { 
    document.getElementById('t'+row).innerText = res.newTotal; 
    alert("Grade Saved!"); 
  }).updateGrade('Ukraine2024', row, score, note, app);
}
</script>
</body>
</html>
